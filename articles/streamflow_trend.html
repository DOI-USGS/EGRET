<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EGRET">
<title>Daily Streamflow Trend Analysis • EGRET</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Daily Streamflow Trend Analysis">
<meta property="og:description" content="EGRET">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53797708-7"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53797708-7');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://www.usgs.gov/" class="external-link"><img src="logo.png" id="logo" alt="Home" style="padding: 0px 50px 0px 0px;"></a>
    <a class="navbar-brand me-2" href="../index.html">EGRET</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.7.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/Overview.html">Overview and Updates</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/EGRET.html">Introduction</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function Help Pages</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Enhancements.html">Enhancements</a>
    <a class="dropdown-item" href="../articles/WRTDSK.html">WRTDS Kalman</a>
    <a class="dropdown-item" href="../articles/parallel.html">Running in Parallel</a>
    <a class="dropdown-item" href="../articles/rResid.html">Random Residuals</a>
    <a class="dropdown-item" href="../articles/SeasonalFraction.html">Seasonal Analysis</a>
    <a class="dropdown-item" href="../articles/streamflow_trend.html">Daily Streamflow Trends</a>
    <a class="dropdown-item" href="../articles/TrendsByMonth.html">Trends by month</a>
    <a class="dropdown-item" href="../articles/AlternativeQMethod.html">Alternative Q Method</a>
    <a class="dropdown-item" href="../articles/Annual_Hydrograph_Timing.html">Annual_Hydrograph_Timing</a>
    <a class="dropdown-item" href="../articles/units.html">Custom Units</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/References_WRTDS.html">Bibliograpy</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://code.usgs.gov/water/EGRET">
    <span class="fa fa-gitlab fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Daily Streamflow Trend Analysis</h1>
            
            <h4 data-toc-skip class="date">2018-05-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/EGRET/blob/HEAD/vignettes/streamflow_trend.Rmd" class="external-link"><code>vignettes/streamflow_trend.Rmd</code></a></small>
      <div class="d-none name"><code>streamflow_trend.Rmd</code></div>
    </div>

    
    
<p>#Introduction</p>
<p>This document describes how to produce a set of graphics and perform
the associated statistical tests that describe trends in daily
streamflow at a single streamgage. The trends depicted cover the full
range of quantiles of the streamflow distribution, from the lowest
discharge of the year, through the median discharge, up through the
highest discharge of the year. The method is built around the R package
<strong>EGRET</strong> <a href="https://CRAN.R-project.org/package=EGRET" class="external-link">Exploration and Graphics
for RivEr Trends</a>. It makes it possible to consider trends over any
portion of the time period for which there are daily streamflow records,
and any period of analysis (the portion of the year to be considered,
e.g. the entire year or just the summer months).</p>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>First, the <code>EGRET</code> package needs to be installed and
loaded. Then, you’ll need need to create an <code>eList</code> object,
which contains site information and daily discharge data for streamgage.
Page 13 of the EGRET user guide <a href="http://pubs.usgs.gov/tm/04/a10/" class="external-link">here</a>.</p>
<p>For this post, we will use the Choptank River in Maryland as our
first example. There is an example data set included in
<code>EGRET</code>. The data set consists of site information, daily
discharge data, and water quality data, but this application does not
use the water quality data. Refer to the section near the end of this
document called <strong>Downloading the data for your site of
interest</strong> to see how you can set up an eList object for any USGS
streamgage.</p>
<p>There are two limitations that users should know about this
application before proceeding any further.</p>
<ol style="list-style-type: decimal">
<li><p><strong>The code was designed for discharge records that are
complete (no gaps).</strong> This is usually not a problem with USGS
discharge records unless there is a major gap (typically years in
length) when the streamgage was not operating. If records have a number
of small gaps, users could use some established method for filling in
missing data to create a gap-free record.</p></li>
<li><p><strong>The discharge on every day should be a positive value
(not zero or negative).</strong> The <code>EGRET</code> code that is
used here to read in new data has a “work around” for situations where
there are a very small number of non-positive discharge values. It adds
a small constant to all the discharge data so they will all be positive.
This should have almost no impact on the results provided the number of
non-positive days is very small, say less than 0.1% of all the days.
That translates to about 11 days out of 30 years. For data sets with
more zero or negative flow days different code would need to be written
(we would appreciate it if an user could work on developing such a set
of code).</p></li>
</ol>
<p>To start, the following R commands are needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pubs.usgs.gov/tm/04/a10/" class="external-link">EGRET</a></span><span class="op">)</span></span>
<span><span class="va">eList</span> <span class="op">&lt;-</span> <span class="va">Choptank_eList</span></span></code></pre></div>
<p>Just to get some sense about the data we will look a portion of the
metadata (gage ID number, name, and drainage area in square kilometers)
and also see a summary of the discharge data (discharge in in cubic
meters per second).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">site.no</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "01491000"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">shortName</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Choptank River"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">drainSqKm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 292.6687</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">Daily</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         Min.      1st Qu.       Median         Mean      3rd Qu.         Max. </span></span>
<span><span class="co">## "1979-10-01" "1987-09-30" "1995-09-30" "1995-09-30" "2003-09-30" "2011-09-30"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">Daily</span><span class="op">$</span><span class="va">Q</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">##   0.00991   0.93446   2.40693   4.08658   4.61565 246.35656</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="loading-the-necessary-packages-and-other-r-code">Loading the necessary packages and other R code<a class="anchor" aria-label="anchor" href="#loading-the-necessary-packages-and-other-r-code"></a>
</h2>
<p>To run the analysis and produce the graphs you will need a few R
functions in addition to the <code>EGRET</code> package. You can copy
the entire block of code shown below here and paste it into your
workspace (all as a single copy and paste) or you can create an .R file
from the code that you will source each time you want to use it. Let’s
say you call it <code>flowTrends.R</code>, then each time you want to
use it you need to “source” the object <code>flowTrends.R</code>.</p>
<p>In addition to <code>EGRET</code> the functions use the packages <a href="https://CRAN.R-project.org/package=rkt" class="external-link"><code>rkt</code></a>, <a href="https://CRAN.R-project.org/package=zyp" class="external-link"><code>zyp</code></a>, <a href="https://CRAN.R-project.org/package=lubridate" class="external-link"><code>lubridate</code></a>,
and <a href="https://CRAN.R-project.org/package=Kendall" class="external-link"><code>Kendall</code></a>.
Make sure you have installed all of them.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rkt</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org" class="external-link">zyp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">########## this is the function you will use to make a single trend graph  ##############</span></span>
<span></span>
<span></span>
<span><span class="va">plotFlowTrend</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">eList</span>, <span class="va">istat</span>, <span class="va">startDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">endDate</span> <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                           <span class="va">paStart</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">paLong</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">window</span> <span class="op">=</span> <span class="fl">30</span>, <span class="va">qMax</span> <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                           <span class="va">printTitle</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">tinyPlot</span> <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                           <span class="va">customPar</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">runoff</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           <span class="va">qUnit</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">printStaName</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">printPA</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           <span class="va">printIstat</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">cex</span> <span class="op">=</span> <span class="fl">0.8</span>, <span class="va">cex.axis</span> <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>                           <span class="va">cex.main</span> <span class="op">=</span> <span class="fl">1.1</span>, <span class="va">lwd</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDaily.html">getDaily</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span>
<span>  <span class="va">localINFO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getInfo.html">getInfo</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">paStart</span> <span class="op">&lt;-</span> <span class="va">paStart</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">paLong</span> <span class="op">&lt;-</span> <span class="va">paLong</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">window</span> <span class="op">&lt;-</span> <span class="va">window</span></span>
<span>  <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span></span>
<span>  <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> </span>
<span>  <span class="op">}</span> </span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">localDaily</span>, <span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">start</span> <span class="op">&amp;</span> <span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">end</span><span class="op">)</span></span>
<span>  <span class="va">eList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.egret.html">as.egret</a></span><span class="op">(</span><span class="va">localINFO</span>,<span class="va">localDaily</span><span class="op">)</span></span>
<span>  <span class="va">localAnnualSeries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAnnualSeries.html">makeAnnualSeries</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span>
<span>  <span class="va">qActual</span> <span class="op">&lt;-</span> <span class="va">localAnnualSeries</span><span class="op">[</span><span class="fl">2</span>, <span class="va">istat</span>, <span class="op">]</span></span>
<span>  <span class="va">qSmooth</span> <span class="op">&lt;-</span> <span class="va">localAnnualSeries</span><span class="op">[</span><span class="fl">3</span>, <span class="va">istat</span>, <span class="op">]</span></span>
<span>  <span class="va">years</span> <span class="op">&lt;-</span> <span class="va">localAnnualSeries</span><span class="op">[</span><span class="fl">1</span>, <span class="va">istat</span>, <span class="op">]</span></span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="va">qActual</span></span>
<span>  <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">years</span></span>
<span>  <span class="va">LogQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span></span>
<span>  <span class="va">mktFrame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">LogQ</span><span class="op">)</span></span>
<span>  <span class="va">mktFrame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">mktFrame</span><span class="op">)</span></span>
<span>  <span class="va">mktOut</span> <span class="op">&lt;-</span> <span class="fu">rkt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rkt/man/rkt.html" class="external-link">rkt</a></span><span class="op">(</span><span class="va">mktFrame</span><span class="op">$</span><span class="va">time</span>,<span class="va">mktFrame</span><span class="op">$</span><span class="va">LogQ</span><span class="op">)</span></span>
<span>  <span class="va">zypOut</span> <span class="op">&lt;-</span> <span class="fu">zyp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zyp/man/zyp.trend.vector.html" class="external-link">zyp.zhang</a></span><span class="op">(</span><span class="va">mktFrame</span><span class="op">$</span><span class="va">LogQ</span>,<span class="va">mktFrame</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="va">slope</span> <span class="op">&lt;-</span> <span class="va">mktOut</span><span class="op">$</span><span class="va">B</span></span>
<span>  <span class="va">slopePct</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">100</span></span>
<span>  <span class="va">slopePct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">slopePct</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">pValue</span> <span class="op">&lt;-</span> <span class="va">zypOut</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span>
<span>  <span class="va">pValue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">pValue</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">qUnit</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qUnit</span> <span class="op">&lt;-</span> <span class="va">qConst</span><span class="op">[</span>shortCode <span class="op">=</span> <span class="va">qUnit</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">qUnit</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qUnit</span> <span class="op">&lt;-</span> <span class="va">qConst</span><span class="op">[</span><span class="va">qUnit</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">qFactor</span> <span class="op">&lt;-</span> <span class="va">qUnit</span><span class="op">@</span><span class="va">qUnitFactor</span></span>
<span>  <span class="va">yLab</span> <span class="op">&lt;-</span> <span class="va">qUnit</span><span class="op">@</span><span class="va">qUnitTiny</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">runoff</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">qActual</span> <span class="op">&lt;-</span> <span class="va">qActual</span> <span class="op">*</span> <span class="fl">86.4</span><span class="op">/</span><span class="va">localINFO</span><span class="op">$</span><span class="va">drainSqKm</span></span>
<span>    <span class="va">qSmooth</span> <span class="op">&lt;-</span> <span class="va">qSmooth</span> <span class="op">*</span> <span class="fl">86.4</span><span class="op">/</span><span class="va">localINFO</span><span class="op">$</span><span class="va">drainSqKm</span></span>
<span>    <span class="va">yLab</span> <span class="op">&lt;-</span> <span class="st">"Runoff in mm/day"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">qActual</span> <span class="op">&lt;-</span> <span class="va">qActual</span> <span class="op">*</span> <span class="va">qFactor</span></span>
<span>    <span class="va">qSmooth</span> <span class="op">&lt;-</span> <span class="va">qSmooth</span> <span class="op">*</span> <span class="va">qFactor</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">localSeries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">qActual</span>, <span class="va">qSmooth</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">yInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generalAxis.html">generalAxis</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">qActual</span>, maxVal <span class="op">=</span> <span class="va">qMax</span>, minVal <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                       tinyPlot <span class="op">=</span> <span class="va">tinyPlot</span><span class="op">)</span></span>
<span>  <span class="va">xInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generalAxis.html">generalAxis</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">localSeries</span><span class="op">$</span><span class="va">years</span>, maxVal <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/decimal_date.html" class="external-link">decimal_date</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>, </span>
<span>                       minVal <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/decimal_date.html" class="external-link">decimal_date</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span>, padPercent <span class="op">=</span> <span class="fl">0</span>, tinyPlot <span class="op">=</span> <span class="va">tinyPlot</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">line1</span> <span class="op">&lt;-</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">shortName</span></span>
<span>  <span class="va">nameIstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"minimum day"</span>, <span class="st">"7-day minimum"</span>, <span class="st">"30-day minimum"</span>, </span>
<span>                 <span class="st">"median daily"</span>, <span class="st">"mean daily"</span>, <span class="st">"30-day maximum"</span>, <span class="st">"7-day maximum"</span>, </span>
<span>                 <span class="st">"maximum day"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">line2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\n"</span>, <span class="fu"><a href="../reference/setSeasonLabelByUser.html">setSeasonLabelByUser</a></span><span class="op">(</span>paStartInput <span class="op">=</span> <span class="va">paStart</span>, </span>
<span>                                              paLongInput <span class="op">=</span> <span class="va">paLong</span><span class="op">)</span>, <span class="st">"  "</span>, <span class="va">nameIstat</span><span class="op">[</span><span class="va">istat</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">line3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\nSlope estimate is "</span>,<span class="va">slopePct</span>,<span class="st">"% per year, Mann-Kendall p-value is "</span>,<span class="va">pValue</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">tinyPlot</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">nameIstat</span><span class="op">[</span><span class="va">istat</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">line1</span>, <span class="va">line2</span>, <span class="va">line3</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">printTitle</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">title</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/genericEGRETDotPlot.html">genericEGRETDotPlot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">localSeries</span><span class="op">$</span><span class="va">years</span>, y <span class="op">=</span> <span class="va">localSeries</span><span class="op">$</span><span class="va">qActual</span>, </span>
<span>                      xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xInfo</span><span class="op">$</span><span class="va">bottom</span>, <span class="va">xInfo</span><span class="op">$</span><span class="va">top</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yInfo</span><span class="op">$</span><span class="va">bottom</span>, </span>
<span>                                                                  <span class="va">yInfo</span><span class="op">$</span><span class="va">top</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="va">yLab</span>, customPar <span class="op">=</span> <span class="va">customPar</span>, </span>
<span>                      xTicks <span class="op">=</span> <span class="va">xInfo</span><span class="op">$</span><span class="va">ticks</span>, yTicks <span class="op">=</span> <span class="va">yInfo</span><span class="op">$</span><span class="va">ticks</span>, cex <span class="op">=</span> <span class="va">cex</span>, </span>
<span>                      plotTitle <span class="op">=</span> <span class="va">title</span>, cex.axis <span class="op">=</span> <span class="va">cex.axis</span>, cex.main <span class="op">=</span> <span class="va">cex.main</span>, </span>
<span>                      tinyPlot <span class="op">=</span> <span class="va">tinyPlot</span>, lwd <span class="op">=</span> <span class="va">lwd</span>, col <span class="op">=</span> <span class="va">col</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">localSeries</span><span class="op">$</span><span class="va">years</span>, <span class="va">localSeries</span><span class="op">$</span><span class="va">qSmooth</span>, lwd <span class="op">=</span> <span class="va">lwd</span>, </span>
<span>        col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">###### this the the function you will use to make the Quantile Kendall Plot #############</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">plotQuantileKendall</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eList</span>, <span class="va">startDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">endDate</span> <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                      <span class="va">paStart</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">paLong</span> <span class="op">=</span> <span class="fl">12</span>,     </span>
<span>                      <span class="va">legendLocation</span> <span class="op">=</span> <span class="st">"topleft"</span>, <span class="va">legendSize</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>                      <span class="va">yMax</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">yMin</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="va">eList</span><span class="op">$</span><span class="va">Daily</span></span>
<span>  <span class="va">localINFO</span> <span class="op">&lt;-</span> <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">paStart</span> <span class="op">&lt;-</span> <span class="va">paStart</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">paLong</span> <span class="op">&lt;-</span> <span class="va">paLong</span></span>
<span>  <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span></span>
<span>  <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> </span>
<span>  <span class="op">}</span> </span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">localDaily</span>, <span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">start</span> <span class="op">&amp;</span> <span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">end</span><span class="op">)</span></span>
<span>  <span class="va">eList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.egret.html">as.egret</a></span><span class="op">(</span><span class="va">localINFO</span>,<span class="va">localDaily</span><span class="op">)</span></span>
<span>  <span class="va">eList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setPA.html">setPA</a></span><span class="op">(</span><span class="va">eList</span>, paStart<span class="op">=</span><span class="va">paStart</span>, paLong<span class="op">=</span><span class="va">paLong</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">makeSortQ</span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span>
<span>  <span class="va">sortQ</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">trendSortQ</span><span class="op">(</span><span class="va">sortQ</span>, <span class="va">time</span><span class="op">)</span></span>
<span>  <span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>,<span class="fl">0.95</span>,<span class="fl">0.99</span>,<span class="fl">0.999</span><span class="op">)</span></span>
<span>  <span class="va">zvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">shortName</span></span>
<span><span class="co">#  ymax &lt;- trunc(max(results$slopePct)*10)</span></span>
<span><span class="co">#  ymax &lt;- max(ymax + 2, 5)</span></span>
<span><span class="co">#  ymin &lt;- floor(min(results$slopePct)*10)</span></span>
<span><span class="co">#  ymin &lt;- min(ymin - 2, -5)</span></span>
<span><span class="co">#  yrange &lt;- c(ymin/10, ymax/10)</span></span>
<span><span class="co">#  yticks &lt;- axisTicks(yrange, log = FALSE)</span></span>
<span>  <span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">slopePct</span> <span class="op">+</span> <span class="fl">0.5</span>, <span class="va">yMax</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">slopePct</span> <span class="op">-</span> <span class="fl">0.5</span>, <span class="va">yMin</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">yrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span></span>
<span>  <span class="va">yticks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/axisTicks.html" class="external-link">axisTicks</a></span><span class="op">(</span><span class="va">yrange</span>, log <span class="op">=</span> <span class="cn">FALSE</span>, nint <span class="op">=</span><span class="fl">7</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">pValueAdj</span></span>
<span>  <span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0.1</span>,<span class="st">"black"</span>,<span class="st">"snow3"</span><span class="op">)</span></span>
<span>  <span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, <span class="st">"red"</span>, <span class="va">color</span><span class="op">)</span></span>
<span>  <span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>,<span class="fl">0.95</span>,<span class="fl">0.99</span>,<span class="fl">0.999</span><span class="op">)</span></span>
<span>  <span class="va">zvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span></span>
<span>  <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\n"</span>, <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">shortName</span>,<span class="st">"\n"</span>,</span>
<span>                 <span class="va">start</span>,<span class="st">" through "</span>, <span class="va">end</span>, <span class="st">"\n"</span>, </span>
<span>                 <span class="fu"><a href="../reference/setSeasonLabelByUser.html">setSeasonLabelByUser</a></span><span class="op">(</span>paStartInput <span class="op">=</span> <span class="va">paStart</span>, paLongInput <span class="op">=</span> <span class="va">paLong</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">z</span>,<span class="va">results</span><span class="op">$</span><span class="va">slopePct</span>,col <span class="op">=</span> <span class="va">color</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">1.0</span>, </span>
<span>       xlab <span class="op">=</span> <span class="st">"Daily non-exceedance probability"</span>, </span>
<span>       ylab <span class="op">=</span> <span class="st">"Trend slope in percent per year"</span>, </span>
<span>       xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.2</span>, <span class="fl">3.2</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="va">yrange</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, </span>
<span>       las <span class="op">=</span> <span class="fl">1</span>, tck <span class="op">=</span> <span class="fl">0.02</span>, cex.lab <span class="op">=</span> <span class="fl">1.2</span>, cex.axis <span class="op">=</span> <span class="fl">1.2</span>, </span>
<span>       axes <span class="op">=</span> <span class="cn">FALSE</span>, frame.plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">name</span>, side <span class="op">=</span><span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0.2</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>,at<span class="op">=</span><span class="va">zvals</span>,labels<span class="op">=</span><span class="va">pvals</span>, las <span class="op">=</span> <span class="fl">1</span>, tck <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="va">yticks</span>,labels <span class="op">=</span> <span class="cn">TRUE</span>, las <span class="op">=</span> <span class="fl">1</span>, tck <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">3</span>,at<span class="op">=</span><span class="va">zvals</span>,labels<span class="op">=</span><span class="cn">FALSE</span>, las <span class="op">=</span> <span class="fl">1</span>, tck<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">4</span>,at<span class="op">=</span><span class="va">yticks</span>,labels <span class="op">=</span> <span class="cn">FALSE</span>, tick <span class="op">=</span> <span class="cn">TRUE</span>, tck <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="va">legendLocation</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt; 0.1"</span>,<span class="st">"0.05 - 0.1"</span>,<span class="st">"&lt; 0.05"</span><span class="op">)</span>,col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snow3"</span>,                                            <span class="st">"black"</span>,<span class="st">"red"</span><span class="op">)</span>,pch <span class="op">=</span> <span class="fl">20</span>, title <span class="op">=</span> <span class="st">"p-value"</span>,</span>
<span>         pt.cex<span class="op">=</span><span class="fl">1.0</span>, cex <span class="op">=</span> <span class="va">legendSize</span> <span class="op">*</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="op">}</span>    </span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">############  This next function combines four individual trend graphs (for mimimum day,</span></span>
<span><span class="co">########### median day, mean day, and maximum day) along with the quantile kendall graph</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">plotFiveTrendGraphs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eList</span>, <span class="va">startDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">endDate</span> <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                                <span class="va">paStart</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">paLong</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">qUnit</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">window</span> <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                                <span class="va">legendLocation</span> <span class="op">=</span> <span class="st">"topleft"</span>, <span class="va">legendSize</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="va">eList</span><span class="op">$</span><span class="va">Daily</span></span>
<span>  <span class="va">localINFO</span> <span class="op">&lt;-</span> <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">paStart</span> <span class="op">&lt;-</span> <span class="va">paStart</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">paLong</span> <span class="op">&lt;-</span> <span class="va">paLong</span></span>
<span>  <span class="va">localINFO</span><span class="op">$</span><span class="va">window</span> <span class="op">&lt;-</span> <span class="va">window</span></span>
<span>  </span>
<span>  <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span></span>
<span>  <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">startDate</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> </span>
<span>  <span class="op">}</span> </span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">endDate</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">localDaily</span>, <span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">start</span> <span class="op">&amp;</span> <span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">end</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">eList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.egret.html">as.egret</a></span><span class="op">(</span><span class="va">localINFO</span>,<span class="va">localDaily</span><span class="op">)</span></span>
<span>  <span class="va">eList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setPA.html">setPA</a></span><span class="op">(</span><span class="va">eList</span>, paStart<span class="op">=</span><span class="va">paStart</span>, paLong<span class="op">=</span><span class="va">paLong</span>, window<span class="op">=</span><span class="va">window</span><span class="op">)</span></span>
<span>  <span class="co"># this next line of code is inserted so that when paLong = 12, we always use the</span></span>
<span>  <span class="co"># climate year when looking at the trends in the annual minimum flow</span></span>
<span>  <span class="va">paStart1</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">paLong</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span>  <span class="fl">4</span> <span class="kw">else</span> <span class="va">paStart</span></span>
<span>  <span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">1</span>, qUnit <span class="op">=</span> <span class="va">qUnit</span>, paStart <span class="op">=</span> <span class="va">paStart1</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, window <span class="op">=</span> <span class="va">window</span><span class="op">)</span></span>
<span>  <span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">4</span>, qUnit <span class="op">=</span> <span class="va">qUnit</span>, paStart <span class="op">=</span> <span class="va">paStart</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, window <span class="op">=</span> <span class="va">window</span><span class="op">)</span></span>
<span>  <span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">8</span>, qUnit <span class="op">=</span> <span class="va">qUnit</span>, paStart <span class="op">=</span> <span class="va">paStart</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, window <span class="op">=</span> <span class="va">window</span><span class="op">)</span></span>
<span>  <span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">5</span>, qUnit <span class="op">=</span> <span class="va">qUnit</span>, paStart <span class="op">=</span> <span class="va">paStart</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, window <span class="op">=</span> <span class="va">window</span><span class="op">)</span></span>
<span>  <span class="co"># now the quantile kendall</span></span>
<span>  <span class="fu">plotQuantileKendall</span><span class="op">(</span><span class="va">eList</span>, startDate <span class="op">=</span> <span class="va">startDate</span>, endDate <span class="op">=</span> <span class="va">endDate</span>, paStart <span class="op">=</span> <span class="va">paStart</span>,</span>
<span>                      paLong <span class="op">=</span> <span class="va">paLong</span>, legendLocation <span class="op">=</span> <span class="va">legendLocation</span>, legendSize <span class="op">=</span> <span class="va">legendSize</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">########### makeSortQ creates a matrix called Qsort. </span></span>
<span><span class="co">############It sorted from smallest to largest over dimDays </span></span>
<span><span class="co">############(if working with full year dimDays=365), </span></span>
<span><span class="co">#############and also creates other vectors that contain information about this array.</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">makeSortQ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eList</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">localINFO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getInfo.html">getInfo</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span>
<span>  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDaily.html">getDaily</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span>
<span>  <span class="va">paStart</span> <span class="op">&lt;-</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">paStart</span></span>
<span>  <span class="va">paLong</span> <span class="op">&lt;-</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">paLong</span></span>
<span>  <span class="co"># determine the maximum number of days to put in the array</span></span>
<span>  <span class="va">numDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">DecYear</span><span class="op">)</span></span>
<span>  <span class="va">monthSeqFirst</span> <span class="op">&lt;-</span> <span class="va">localDaily</span><span class="op">$</span><span class="va">MonthSeq</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">monthSeqLast</span> <span class="op">&lt;-</span> <span class="va">localDaily</span><span class="op">$</span><span class="va">MonthSeq</span><span class="op">[</span><span class="va">numDays</span><span class="op">]</span></span>
<span>  <span class="co"># creating a data frame (called startEndSeq) of the MonthSeq values that go into each year</span></span>
<span>  <span class="va">Starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">paStart</span>, <span class="va">monthSeqLast</span>, <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="va">Ends</span> <span class="op">&lt;-</span> <span class="va">Starts</span> <span class="op">+</span> <span class="va">paLong</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">startEndSeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Starts</span>, <span class="va">Ends</span><span class="op">)</span></span>
<span>  <span class="co"># trim this list of Starts and Ends to fit the period of record</span></span>
<span>  <span class="va">startEndSeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">startEndSeq</span>, <span class="va">Ends</span> <span class="op">&gt;=</span> <span class="va">monthSeqFirst</span> <span class="op">&amp;</span> <span class="va">Starts</span> <span class="op">&lt;=</span> <span class="va">monthSeqLast</span><span class="op">)</span></span>
<span>  <span class="va">numYearsRaw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">startEndSeq</span><span class="op">$</span><span class="va">Ends</span><span class="op">)</span></span>
<span>  <span class="co"># set up some vectors to keep track of years</span></span>
<span>  <span class="va">good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">numYearsRaw</span><span class="op">)</span></span>
<span>  <span class="va">numDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">numYearsRaw</span><span class="op">)</span></span>
<span>  <span class="va">midDecYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">numYearsRaw</span><span class="op">)</span></span>
<span>  <span class="va">Qraw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">366</span>, ncol <span class="op">=</span> <span class="va">numYearsRaw</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> <span class="va">numYearsRaw</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">startSeq</span> <span class="op">&lt;-</span> <span class="va">startEndSeq</span><span class="op">$</span><span class="va">Starts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">endSeq</span> <span class="op">&lt;-</span> <span class="va">startEndSeq</span><span class="op">$</span><span class="va">Ends</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">startJulian</span> <span class="op">&lt;-</span> <span class="fu">getFirstJulian</span><span class="op">(</span><span class="va">startSeq</span><span class="op">)</span></span>
<span>    <span class="co"># startJulian is the first julian day of the first month in the year being processed</span></span>
<span>    <span class="co"># endJulian is the first julian day of the month right after the last month in the year being processed</span></span>
<span>    <span class="va">endJulian</span> <span class="op">&lt;-</span> <span class="fu">getFirstJulian</span><span class="op">(</span><span class="va">endSeq</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">fullDuration</span> <span class="op">&lt;-</span> <span class="va">endJulian</span> <span class="op">-</span> <span class="va">startJulian</span></span>
<span>    <span class="va">yearDaily</span> <span class="op">&lt;-</span> <span class="va">localDaily</span><span class="op">[</span><span class="va">localDaily</span><span class="op">$</span><span class="va">MonthSeq</span> <span class="op">&gt;=</span> <span class="va">startSeq</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">MonthSeq</span> <span class="op">&lt;=</span> <span class="va">endSeq</span><span class="op">)</span>, <span class="op">]</span></span>
<span>    <span class="va">nDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yearDaily</span><span class="op">$</span><span class="va">Q</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">nDays</span> <span class="op">==</span> <span class="va">fullDuration</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">good</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">numDays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">nDays</span></span>
<span>      <span class="va">midDecYear</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">yearDaily</span><span class="op">$</span><span class="va">DecYear</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">yearDaily</span><span class="op">$</span><span class="va">DecYear</span><span class="op">[</span><span class="va">nDays</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>      <span class="va">Qraw</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nDays</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">yearDaily</span><span class="op">$</span><span class="va">Q</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">numDays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>      <span class="va">midDecYear</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># now we compress the matrix down to equal number of values in each column</span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">numGoodYears</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">good</span><span class="op">)</span></span>
<span>  <span class="va">dayCounts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">good</span><span class="op">==</span><span class="fl">1</span>, <span class="va">numDays</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="va">lowDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dayCounts</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">highDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dayCounts</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">dimYears</span> <span class="op">&lt;-</span> <span class="va">numGoodYears</span></span>
<span>  <span class="va">dimDays</span> <span class="op">&lt;-</span> <span class="va">lowDays</span></span>
<span>  <span class="va">sortQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">dimDays</span>, ncol <span class="op">=</span> <span class="va">dimYears</span><span class="op">)</span></span>
<span>  <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">dimYears</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numYearsRaw</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">good</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="va">numD</span> <span class="op">&lt;-</span> <span class="va">numDays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">Qraw</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">numD</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="co"># separate odd numbers from even numbers of days</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">numD</span> <span class="op">==</span> <span class="va">lowDays</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sortQ</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">dimDays</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">sortQ</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">dimDays</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="fu">odd</span><span class="op">(</span><span class="va">numD</span><span class="op">)</span><span class="op">)</span> <span class="fu">leapOdd</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">else</span> <span class="fu">leapEven</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="va">time</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">midDecYear</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">}</span> </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">sortQList</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sortQ</span>,<span class="va">time</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">sortQList</span><span class="op">)</span>         </span>
<span><span class="op">}</span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">########## Another function trendSortQ needed for Quantile Kendall</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">trendSortQ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Qsort</span>, <span class="va">time</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># note requires packages zyp and rkt</span></span>
<span>  <span class="va">nFreq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Qsort</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">nYears</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">9</span>,nrow<span class="op">=</span><span class="va">nFreq</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"slopeLog"</span>,<span class="st">"slopePct"</span>,<span class="st">"pValue"</span>,<span class="st">"pValueAdj"</span>,<span class="st">"tau"</span>,<span class="st">"rho1"</span>,<span class="st">"rho2"</span>,<span class="st">"freq"</span>,<span class="st">"z"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">iRank</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nFreq</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mkOut</span> <span class="op">&lt;-</span> <span class="fu">rkt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rkt/man/rkt.html" class="external-link">rkt</a></span><span class="op">(</span><span class="va">time</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Qsort</span><span class="op">[</span><span class="va">iRank</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">slopeLog</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mkOut</span><span class="op">$</span><span class="va">B</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">slopePct</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">mkOut</span><span class="op">$</span><span class="va">B</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">pValue</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mkOut</span><span class="op">$</span><span class="va">sl</span></span>
<span>    <span class="va">outZYP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zyp/man/zyp.trend.vector.html" class="external-link">zyp.zhang</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Qsort</span><span class="op">[</span><span class="va">iRank</span>,<span class="op">]</span><span class="op">)</span>,<span class="va">time</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">pValueAdj</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">outZYP</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mkOut</span><span class="op">$</span><span class="va">tau</span></span>
<span>    <span class="co"># I don't actually use this information in the current outputs, but the code is there </span></span>
<span>    <span class="co"># if one wanted to look at the serial correlation structure of the flow series      </span></span>
<span>    <span class="va">serial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Qsort</span><span class="op">[</span><span class="va">iRank</span>,<span class="op">]</span><span class="op">)</span>, lag.max <span class="op">=</span> <span class="fl">2</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">rho1</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">serial</span><span class="op">$</span><span class="va">acf</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">rho2</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">serial</span><span class="op">$</span><span class="va">acf</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">frequency</span> <span class="op">&lt;-</span> <span class="va">iRank</span> <span class="op">/</span> <span class="op">(</span><span class="va">nFreq</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">freq</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">frequency</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">z</span><span class="op">[</span><span class="va">iRank</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">frequency</span><span class="op">)</span>    </span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">################################## getFirstJulian finds the julian date of first day</span></span>
<span><span class="co">################################## of a given month</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">getFirstJulian</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">monthSeq</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">1850</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">monthSeq</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="va">month</span> <span class="op">&lt;-</span> <span class="va">monthSeq</span> <span class="op">-</span> <span class="fl">12</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">monthSeq</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">charMonth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">month</span><span class="op">&lt;</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"0"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">theDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>,<span class="st">"-"</span>,<span class="va">charMonth</span>,<span class="st">"-01"</span><span class="op">)</span></span>
<span>  <span class="va">Julian1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">julian</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">theDate</span><span class="op">)</span>,origin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1850-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Julian1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">########### leapOdd  is a function for deleting one value </span></span>
<span><span class="co">############when the period that contains Februaries has a length that is an odd number</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">leapOdd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">mid</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">mid1</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">midMinus</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">midMinus</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">midMinus</span><span class="op">]</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">mid</span><span class="op">:</span><span class="va">m</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">mid1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">########### leapEven  is a function for deleting one value </span></span>
<span><span class="co">############when the period that contains Februaries has a length that is an even number</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">leapEven</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">mid</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">mid1</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">mid2</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">+</span> <span class="fl">2</span></span>
<span>  <span class="va">midMinus</span> <span class="op">&lt;-</span> <span class="va">mid</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">midMinus</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">midMinus</span><span class="op">]</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">mid</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">mid</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">mid1</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">mid1</span><span class="op">:</span><span class="va">m</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">mid2</span> <span class="op">:</span> <span class="va">n</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">####### determines if the length of a vector is an odd number ###########################</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">odd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">########### calcWY calculates the water year and inserts it into a data frame</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span></span>
<span><span class="va">calcWY</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">WaterYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DecYear</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">WaterYear</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Month</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">WaterYear</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Month</span> <span class="op">&gt;=</span> </span>
<span>                                                 <span class="fl">10</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">##### calcCY calculates the climate year and inserts it into a data frame</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">calcCY</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">ClimateYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DecYear</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">ClimateYear</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Month</span> <span class="op">&gt;=</span> <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">ClimateYear</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Month</span> <span class="op">&gt;=</span> </span>
<span>                                                    <span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#########################################################################################</span></span>
<span><span class="co">######## smoother is a function does the trend in real discharge units and not logs. </span></span>
<span><span class="co">######## It is placed here so that users wanting to run this alternative have it available</span></span>
<span><span class="co">######## but it is not actually called by any function in this document</span></span>
<span><span class="co">#########################################################################################</span></span>
<span></span>
<span><span class="va">smoother</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xy</span>, <span class="va">window</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">edgeAdjust</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">$</span><span class="va">x</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">$</span><span class="va">y</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">xn</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">n</span><span class="op">]</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">xi</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">distToEdge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">(</span><span class="va">xi</span> <span class="op">-</span> <span class="va">x1</span><span class="op">)</span>, <span class="op">(</span><span class="va">xn</span> <span class="op">-</span> <span class="va">xi</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">close</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">distToEdge</span> <span class="op">&lt;</span> <span class="va">window</span><span class="op">)</span></span>
<span>    <span class="va">thisWindow</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">edgeAdjust</span> <span class="op">&amp;</span> <span class="va">close</span><span class="op">)</span> </span>
<span>      <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">window</span><span class="op">)</span> <span class="op">-</span> <span class="va">distToEdge</span></span>
<span>    <span class="kw">else</span> <span class="va">window</span></span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triCube.html">triCube</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">xi</span>, <span class="va">thisWindow</span><span class="op">)</span></span>
<span>    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">xy</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, weights <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span>    <span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">new</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="making-a-graph-of-the-trend-in-a-single-flow-statistic">Making a graph of the trend in a single flow statistic<a class="anchor" aria-label="anchor" href="#making-a-graph-of-the-trend-in-a-single-flow-statistic"></a>
</h2>
<p>Now all we need to do is to run the <strong>plotFlowTrend</strong>
function that was the first part of the code we just read in. First we
will run it in its simplest form, we will use the entire discharge
record and our period of analysis will be the full <strong>climatic
year</strong>. A climatic year is the year that starts on April 1 and
ends on March 31. It is our default approach because it tends to avoid
breaking a long-low flow period into two segments, one in each of two
adjacent years. We will first run it for the annual minimum daily
discharge.</p>
<p>To use it you will need to know about the index of flow statistics
used in EGRET. They are called <strong>istat</strong> and the statistics
represented by <strong>istat</strong> are: (1) 1-day minimum, (2) 7-day
minimum, (3) 30-day minimum, (4) median (5) mean, (6) 30-day maximum,
(7) 7-day maximum, and (8) 1-day maximum. So to run the annual minimum
daily discharge statistic we would set <strong>istat = 1</strong>. To
run the <strong>plotFlowTrend</strong> function it in its simplest form
the only arguments we need are the eList (which contains the metadata
and the discharge data), and istat.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-4-1.png" alt="Discharge as a function of Year, slope estimates -0.5% and Mann-Kendall p-value 0.785" width="700"><p class="caption">
Discharge as a function of Year, slope estimates -0.5% and Mann-Kendall
p-value 0.785
</p>
</div>
<div class="section level3">
<h3 id="explanation-of-the-flowtrend-plot-annual-minimum-day">Explanation of the FlowTrend Plot, annual minimum day<a class="anchor" aria-label="anchor" href="#explanation-of-the-flowtrend-plot-annual-minimum-day"></a>
</h3>
<p>The dots indicate the discharge on the minimum day of each climate
year in the period of record. The solid curve is a smoothed
representation of those data. It is specifically the smoother that is
defined in the EGRET user guide (pages 16-18) with a 30-year window. For
record as short as this one (only 32 years) it will typically look like
a straight line or a very smooth curve. For longer records it can
display some substantial changes in slope and even be non-monotonic. At
the top of the graph we see two pieces of information. A trend slope
expressed in percent per year and a p-value for the Mann-Kendall trend
test of the data. The slope is computed using the Thiel-Sen slope
estimator. It is discussed on pages 266-274 of Helsel and Hirsch, 2002,
which can be found <a href="https://pubs.usgs.gov/twri/twri4a3/" class="external-link">here</a> although it is
called the “Kendall-Theil Robust Line” in that text. It is calculated on
the logarithms of the discharge data and then transformed to express the
trend in percent per year. The p-value for the Mann-Kendall test is
computed using the adjustment for serial correlation introduced in the
zyp R package (David Bronaugh and Arelia Werner for the Pacific Climate
Impacts Consortium (2013). zyp: Zhang + Yue-Pilon trends package. R
package version 0.10-1. <a href="https://CRAN.R-project.org/package=zyp" class="external-link uri">https://CRAN.R-project.org/package=zyp</a>).</p>
</div>
</div>
<div class="section level2">
<h2 id="a-few-more-flowtrend-plots">A few more FlowTrend Plots<a class="anchor" aria-label="anchor" href="#a-few-more-flowtrend-plots"></a>
</h2>
<p>We can do some other similar plots. In this case we will do the
annual median day <strong>istat = 4</strong>, the annual maximum day
<strong>istat = 8</strong>, and the annual mean day <strong>istat =
5</strong>.</p>
<div class="section level3">
<h3 id="the-annual-median-day">The annual median day<a class="anchor" aria-label="anchor" href="#the-annual-median-day"></a>
</h3>
<p>The median day is computed for each year in the record.It is the
middle day, that is 182 values had discharges lower than it and 182
values had discharges greater than it (for a leap year it is the average
of the 183rd and 184th ranked values). Everything else about it is the
same as the first plot. Here is the annual median day discharge
record.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-5-1.png" alt="Discharge as a function of Year annual median day" width="700"><p class="caption">
Discharge as a function of Year annual median day
</p>
</div>
</div>
<div class="section level3">
<h3 id="the-annual-maximum-day">The annual maximum day<a class="anchor" aria-label="anchor" href="#the-annual-maximum-day"></a>
</h3>
<p>The third plot is for the <em>maximum day</em> of the year. Otherwise
it is exactly the same in its construction as the first two plots. Note
that this is the maximum daily average discharge and in general it will
be smaller than the annual peak discharge, which is the maximum
instantaneous discharge for the year, whereas this is the highest daily
average discharge. For very large rivers the annual maximum day
discharge tends to be very close to the annual peak discharge and can
serve as a rough surrogate for it in a trend study. For a small stream,
where discharges may rise or fall by a factor of 2 or more in the course
of a day, these maximimum day values can be very different from the
annual peak discharge.</p>
<p>At this point we will add one more concept, which is the period of
analysis. In the first two plots the data were organized by
<strong>climate year</strong>. But, when we look at annual maximum or
annual mean discharge the standard approach is to use the water year. To
do this we need to designate that we want our <strong>period of
analysis</strong> to start with the month of October (month 10). To do
this we need to add one more argument to our call to the function.
<strong>paStart = 10</strong>. We did not need to specify the
<strong>paStart</strong> in the first two plots, because the default is
<strong>paStart = 4.</strong> Notice that this change in the period of
analysis is noted in the text on the graphic.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">8</span>, paStart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-6-1.png" alt="Discharge as a function of Year annual maximum day" width="700"><p class="caption">
Discharge as a function of Year annual maximum day
</p>
</div>
<p>The fourth plot is the <em>annual mean discharge</em>. It is
constructed in exactly the same manner as the previous three, but it
represents the mean streamflow for all of the days in the year rather
than a single order statistic such as minimum, median, or maximum. We
will also use the water year for this analysis.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">5</span>, paStart <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-7-1.png" alt="Discharge as a function of Year annual mean discharge" width="700"><p class="caption">
Discharge as a function of Year annual mean discharge
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="some-observations-about-these-figures">Some observations about these figures<a class="anchor" aria-label="anchor" href="#some-observations-about-these-figures"></a>
</h2>
<p>It is interesting to note that the minimum discharge values have been
trending downwards, although not a statistically significant trend. The
other three discharge statistics are all trending upwards and this is
most notable in terms of the annual maximum daily discharge, both in
terms of slope +4.7% per year, and a p-value that is well below 0.001.
This raises many questions about how the variability of discharge might
be changing over time and what the drivers are of the trends that are
happening in various parts of the probability distribution of discharge
(which we commonly call the <strong>flow duration curve</strong>). We
will turn our focus to a way of summarizing these changes after we look
at a few more variations on this plotFlowTrend graphic.</p>
</div>
<div class="section level2">
<h2 id="variations-on-the-simplest-example">Variations on the simplest example<a class="anchor" aria-label="anchor" href="#variations-on-the-simplest-example"></a>
</h2>
<p>The call to the function <strong>plotFlowTrend</strong> has many
arguments (you can see them all in the code shown above) but here we
will just focus on a few that may be most useful to the data
analyst:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, <span class="va">istat</span>, startDate <span class="op">=</span> <span class="cn">NA</span>, endDate <span class="op">=</span> <span class="cn">NA</span>, paStart <span class="op">=</span> <span class="fl">4</span>, paLong <span class="op">=</span> <span class="fl">12</span>, window <span class="op">=</span> <span class="fl">30</span>, qMax <span class="op">=</span> <span class="cn">NA</span>, qUnit <span class="op">=</span> <span class="fl">2</span>, runoff <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Here is a list of the optional arguments that are available to the
user.</p>
<p><strong>startDate</strong> If we want to evaluate the trend for a
shorter period than what is contained in the entire Daily data frame,
then we can specify a different starting date. For example, if we wanted
the analysis to start with Water Year 1981, then we would say: startDate
= “1980-10-01”. By leaving out the startDate argment we are requesting
the analysis to start where the data starts (which in this case is
1979-10-01).</p>
<p><strong>endDate</strong> If we want to evalute the trend for a period
that ends before the end of the data set we can specify that with
endDate. So if we wanted to end with Water Year 2009 we would say:
endDate = “2009-09-30”.</p>
<p><strong>paStart</strong> is the starting month of the period of
analysis. For example if we were interested in the trends in streamflow
in a series of months starting with August, we would say paStart = 8.
The default is paStart = 4, which starts in April.</p>
<p><strong>paLong</strong> is the duration of the period of analysis.
So, an analysis that covers all 12 months would have paLong = 12 (the
default). A period that runs for the months of August - November would
have paStart = 8 and paLong = 4. See pages 14 and 15 of the user guide
for more detail on paStart and paLong.</p>
<p><strong>window</strong> The smoothness of the curve plotted depends
on the size of the window (which is measured in years). If
<strong>window</strong> were much smaller (say 10) then the curve shown
would be rather jagged, and as it becomes longer it causes the curve to
converge to a straight line. The default value of 30 works well and is
also roughly consistant with the convention used in the climate science
community, when they discuss a 30-year normal period. The precise
meaning of <strong>window</strong> is described in the User Guide (pages
16 - 18). It has no effect on the reported trend slope or p-value.</p>
<p><strong>qMax</strong> is an argument that allows the user to set the
maximum value on the vertical axis. If it is left out, the graphic
scales itself. But for a set of similar graphics it may be useful to set
qMax.</p>
<p><strong>qUnit</strong> is an argument that allows the user to pick
different discharge units. The default is <strong>qUnit = 2</strong>
which is cubic meters per second. The other most common unit to use is
<strong>qUnit = 1</strong> which is cubic feet per second.</p>
<p><strong>runoff</strong> is a logical argument. The default is
<strong>runoff = FALSE</strong>. In some studies it is nice to express
discharge in runoff terms (discharge per unit area) amd setting
<strong>runoff = TRUE</strong> can cause it to be expressed in terms of
runoff.</p>
<p>Here is an example that shows the use of several of these arguments.
Say we want to see what would happen if we only looked at annual maximum
daily discharge from 1983 - 2010 (trimming off three low years at the
start and one high year at the end), and used a shorter smoothing
window, and expressed our results as runoff in mm/day</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotFlowTrend</span><span class="op">(</span><span class="va">eList</span>, istat <span class="op">=</span> <span class="fl">8</span>, startDate <span class="op">=</span> <span class="st">"1982-10-01"</span>, endDate <span class="op">=</span> <span class="st">"2010-09-30"</span>, window <span class="op">=</span> <span class="fl">15</span>, runoff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-9-1.png" alt="Discharge as a function of year runoff plot" width="700"><p class="caption">
Discharge as a function of year runoff plot
</p>
</div>
<p>It is worth noting here that compared to the previous plot of the
annual maximum daily discharges, the removal of four particular years
brought about a substantial change in the slope and the significance of
the trend. This is a common issue in trend analysis with relatively
short records.</p>
</div>
<div class="section level2">
<h2 id="the-quantile-kendall-plot">The Quantile-Kendall Plot<a class="anchor" aria-label="anchor" href="#the-quantile-kendall-plot"></a>
</h2>
<p>Now we will look at a new kind of plot called the
<em>Quantile-Kendall plot</em>. Each plotted point on the plot is a
trend slope (computed in the same manner as in the previous plots) for a
given order statistic. The point at the far left edge is the first order
statistic, which is the annual minimum daily discharge. This is the
result described on the first plot. The next point to its right is the
trend slope for the second order statistic (second lowest daily
discharge for each year), and it continues to the far right being the
trend slope for the 365th order statistic (annual maximum daily
discharge). Their placement with respect to the x-axis is based on the
z-statistic (standard normal deviate) associated with that order
statistic. It is called the daily non-exceedance probability. It is a
scale used for convenience. It in no-way assumes that the data follow
any particular distribution. It is simply used to provide the greatest
resolution near the tails of the daily discharge distribution. The color
represents the p value for the Mann-Kendall test for trend as described
above. Red indicates a trend that is significant at alpha = 0.05. Black
indicates an attained significance between 0.05 and 0.1. The grey dots
are trends that are not significant at the alpha level of 0.1.</p>
<p>Here is what it looks like for the Choptank data set. What we see is
that generally across the probability distribution the changes are
generally not statistically significant except for the highest and
second highest days of the year. The trends are slightly negative at the
low end of the distribution (the lowest 10%). Near the median they are
positive and modestly large (around 1.5% per year). Then near the 90th
percentile they drop to near zero slope and only above about the 99th
percentile do they seem to be particularly large.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotQuantileKendall</span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-10-1.png" alt="The Quantile-Kendall Plot" width="700"><p class="caption">
The Quantile-Kendall Plot
</p>
</div>
<p>There is one special manipulation of the data that is needed to
account for leap years (this is a detail about the computation but is
not crucial to understanding the plots). The 366 daily values observed
in a leap year are reduced by one so that all years have 365 values. The
one value eliminated is accomplished by replacing the two middle values
in the ranked list of values by a single value which is the average of
the two. A similar approach is used when the period of analysis is any
set of months that contains the month of February. The number of leap
year values are reduced by one and the reduction takes place at the
median value for the year.</p>
</div>
<div class="section level2">
<h2 id="variations-on-the-quantile-kendall">Variations on the Quantile Kendall<a class="anchor" aria-label="anchor" href="#variations-on-the-quantile-kendall"></a>
</h2>
<p>We might be interested in particularly looking at trends in a certain
season of the year. In the case of the Choptank we know that tropical
storm generated floods have been particularly significant in the later
part of this record and these have been mostly in August, September and
October. Or, if our interest were related to the flows happening in the
spring and early summer, which is the period of time during which the
delivery to the Chesapeake Bay (into which the Choptank River flows)
then we might want to run our analysis on the period March through June.
To do that we can use <strong>paStart = 3 and paLong = 4</strong>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotQuantileKendall</span><span class="op">(</span><span class="va">eList</span>, paStart <span class="op">=</span> <span class="fl">3</span>, paLong <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-11-1.png" alt="The Quantile-Kendall Plot in spring" width="700"><p class="caption">
The Quantile-Kendall Plot in spring
</p>
</div>
<p>What we can see is that for this portion of the year, the discharge
trends are rather minimal and certainly not statistically significant,
except that the 5 or so highest flow days in the season do show rather
large trends and the annual maximum trend is the largest of all (in
percent per year) and is the only one that is significcant.</p>
<p>There are a few other arguments for the
<strong>plotQuantileKendall</strong> function. As mentioned in the
discussion of the <strong>plotFlowTrend</strong> function, it has the
<strong>startDate and endDate</strong> arguments. If they aren’t
specified then it is assumed that the analysis covers the whole period
in the Daily data frame.</p>
<p>There are two arguments that relate to the appearance of the
graph.</p>
<p><strong>legendLocation</strong> this argument simply determines where
in the graph the legend is placed. It sometimes happens that the legend
obscures the data so we may need to move it to another part of the
graph. The argument can take on names such as “bottomleft”, “topright”
or “bottomright”. The default is “topleft”. If you don’t want a legend
(say you are making many Quantile Kendall plots in a single job and
can’t go in and adjust each one), then you can specify
<strong>legendLocation = NA</strong>.</p>
<p><strong>legendSize</strong> this argument determines the size of the
legend. The default is legendSize = 1.0. If you want to decrease the
dimensions of the legend you decrease this value. For example a 25%
reduction would be achieved by setting <strong>legendSize =
0.75</strong>. Typically one wouldn’t want to go below about 0.4.</p>
<p><strong>yMax and yMin</strong> are two more optional arguments to set
up the limits on the y-axis. If you don’t specify them (just leave them
out) then the data will dictate the minimum and maximum values on the
y-axis (it will extend slightly beyond the highest and lowest values).
But, if you are doing many graphs you may want them to have consistent
axes, so a quick look at the graph will tell you if the trends are large
or small, then you can set these two values. For example, say you want
every graph to have a maximum value of 5 and a minimum value of -5, then
the arguments would just be: <strong>yMax = 5, yMin = 5</strong>. There
is a “fail safe” mechanism in the code if the trends are bigger than the
specified values. Let’s say we set <strong>yMax = 5</strong> but in one
particular graph there is a trend slope of 7.2 % per year. In this case
the y-axis would extend out slightly beyond a value of 7.2. Thus, no
value is ever out of range. All of the slopes will be plotted.</p>
<p>Here is an example bringing all of the arguments into play. It is for
a case where we want to consider the time period 1982-08-01 through
2010-11-30, for only the months of August through October, and we want
the legend to go in the bottom right and be only half the size of what
we saw in the first example.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotQuantileKendall</span><span class="op">(</span><span class="va">eList</span>, startDate <span class="op">=</span> <span class="st">"1982-08-01"</span>, endDate <span class="op">=</span> <span class="st">"2010-11-30"</span>, </span>
<span>paStart <span class="op">=</span> <span class="fl">8</span>, paLong <span class="op">=</span> <span class="fl">3</span>, legendLocation <span class="op">=</span> <span class="st">"bottomright"</span>, legendSize <span class="op">=</span> <span class="fl">0.5</span>, yMax <span class="op">=</span> <span class="fl">4</span>, yMin <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-12-1.png" alt="The Quantile-Kendall Plot with design modifications" width="700"><p class="caption">
The Quantile-Kendall Plot with design modifications
</p>
</div>
<p>What this graph shows us is that unlike the year as a whole, this
late summer to fall period has been one of very substantially increasing
discharge. From about the median of the distribution to the top, the
trends are greater than 3% per year and many are significant at least at
the alpha level of 0.1. There is one feature of this figure that may
look odd. That is the fact that at the lower end of the distribution
there are many trend slopes that are exactly zero. Using the gray dot at
the far left as an example, the trend slope estimation method uses all
pairwise comparisons of the lowest discharge of each year. Because of
the USGS reporting conventions, many of these discharge values cluster
around a few specific values, so that in the comparisons, there are many
ties. The slope estimate is the median of all the pairwise slopes and
since a significant number of these slopes are zero, the slope estimate
is zero.</p>
</div>
<div class="section level2">
<h2 id="putting-it-all-together-into-a-set-of-five-graphs">Putting it all together into a set of five graphs<a class="anchor" aria-label="anchor" href="#putting-it-all-together-into-a-set-of-five-graphs"></a>
</h2>
<p>This post also provides an additional function that produces a total
of five graphics from a single command. It does the four trend plots and
then the Quantile-Kendall. It is called
<strong>plotFiveTrendGraphs.</strong> The arguments are all ones that we
have seen before: <strong>eList, startDate, endDate, paStart, paLong,
qUnit, window, legendLocation, and legendSize.</strong> In its simplest
form it would look like this (output not plotted here).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotFiveTrendGraphs</span><span class="op">(</span><span class="va">eList</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downloading-the-data-for-your-site-of-interest">Downloading the data for your site of interest<a class="anchor" aria-label="anchor" href="#downloading-the-data-for-your-site-of-interest"></a>
</h2>
<p>The steps for downloading data from USGS web services (or obtaining
it from user supplied information) and also for creating and saving the
eList are described on pages 4-13 of the EGRET user guide. Here is a
simple example:</p>
<p>Say we want to look at USGS station number 01646500 (Sugar River near
Brodhead, WI) and we want to consider data from Climate Years 1921
through 2016. Note that this much longer period of record causes the
computations to take a good deal more time than the previous cases, but
it should still take well under a minute to complete the whole job. The
following commands would do what is needed.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pubs.usgs.gov/tm/04/a10/" class="external-link">EGRET</a></span><span class="op">)</span></span>
<span><span class="va">sta</span> <span class="op">&lt;-</span> <span class="st">"05436500"</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="st">"00060"</span> <span class="co"># this is the parameter code for daily discharge</span></span>
<span><span class="va">startDate</span> <span class="op">&lt;-</span> <span class="st">"1920-04-01"</span></span>
<span><span class="va">endDate</span> <span class="op">&lt;-</span> <span class="st">"2016-03-31"</span></span>
<span><span class="va">INFO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/INFOdataframe.html">readNWISInfo</a></span><span class="op">(</span>siteNumber <span class="op">=</span> <span class="va">sta</span>, parameterCd <span class="op">=</span> <span class="va">param</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readNWISDaily.html">readNWISDaily</a></span><span class="op">(</span>siteNumber <span class="op">=</span> <span class="va">sta</span>, parameterCd <span class="op">=</span> <span class="va">param</span>, startDate <span class="op">=</span> <span class="va">startDate</span>, </span>
<span>endDate <span class="op">=</span> <span class="va">endDate</span>, verbose <span class="op">=</span>  <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">eList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.egret.html">as.egret</a></span><span class="op">(</span><span class="va">INFO</span>, <span class="va">Daily</span><span class="op">)</span></span>
<span><span class="fu">plotFiveTrendGraphs</span><span class="op">(</span><span class="va">eList</span>, legendLocation <span class="op">=</span> <span class="st">"bottomleft"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-14-1.png" alt="Quantile-Kendall Plots of the Sugar River near Brodhead, WI" width="700"><p class="caption">
Quantile-Kendall Plots of the Sugar River near Brodhead, WI
</p>
</div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-14-2.png" alt="Quantile-Kendall Plots of the Sugar River near Brodhead, WI" width="700"><p class="caption">
Quantile-Kendall Plots of the Sugar River near Brodhead, WI
</p>
</div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-14-3.png" alt="Quantile-Kendall Plots of the Sugar River near Brodhead, WI" width="700"><p class="caption">
Quantile-Kendall Plots of the Sugar River near Brodhead, WI
</p>
</div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-14-4.png" alt="Quantile-Kendall Plots of the Sugar River near Brodhead, WI" width="700"><p class="caption">
Quantile-Kendall Plots of the Sugar River near Brodhead, WI
</p>
</div>
<div class="figure">
<img src="streamflow_trend_files/figure-html/unnamed-chunk-14-5.png" alt="Quantile-Kendall Plots of the Sugar River near Brodhead, WI" width="700"><p class="caption">
Quantile-Kendall Plots of the Sugar River near Brodhead, WI
</p>
</div>
</div>
<div class="section level2">
<h2 id="final-thoughts">Final thoughts<a class="anchor" aria-label="anchor" href="#final-thoughts"></a>
</h2>
<p>This last set of plots is particularly interesting. What we see is
that for the lowest 90 percent of the distribution, discharges have been
rising over most of this record, and particularly so since about 1950.
But in the highest 1% of the distribution discharges have been falling
thoughout the record. As a consequence the overall variablity of
streamflow in this agricultural watershed has generally been declining
over time. This is generally thought to be related to the increasing use
of conservation practices in the watershed.</p>
<p>It is worth noting that we can express the percentage changes per
year in other ways than as percent per year, for example percentage
change per decade or percentage change over the entire period of record.
Take, for example, the estimated trend slope for the median in this last
example. It is 0.68% per year. If we were to express that as percentage
change per decade it would be 7% per decade (the change can be computed
as 1.0068^10, or 1.070, which is a 7% increase). If we expressed it for
the entire 96 year record it would be about a 92% increase over that
period (computed as 1.0068^96, which is 1.9167 or and increase of about
92%).</p>
<p>These graphical tools are one way of summarizing what we might call a
<strong>signature of change</strong> for any given watershed. It shows
the changes, or lack of changes, that have taken place through all parts
of the probability distribution of streamflow. This has potential as a
tool for evaluating hydrologic or linked climate and hydrologic models.
Observing the patterns on these graphs for the actual data versus the
patterns seen when simulated data are used, can provide insights on the
ability of the models used to project hydrologic changes into the
future.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer></footer>
</div> <!-- / div for your main content-->

<!-- BEGIN USGS Footer Template -->

<footer class="footer"><div class="tmp-container">
		<!-- .footer-wrap -->
			<!-- .footer-doi -->
			<div class="footer-doi">
				<!-- footer nav links -->
				<ul class="menu nav">
<li class="first leaf menu-links menu-level-1"><a href="https://www.doi.gov/privacy" class="external-link">DOI Privacy Policy</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/policies-and-notices" class="external-link">Legal</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/accessibility-and-us-geological-survey" class="external-link">Accessibility</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/sitemap" class="external-link">Site Map</a></li>
					<li class="last leaf menu-links menu-level-1"><a href="https://answers.usgs.gov/" class="external-link">Contact USGS</a></li>
				</ul>
<!--/ footer nav links -->
</div>
			<!-- /.footer-doi -->

			<hr>
<!-- .footer-utl-links --><div class="footer-doi">
			<ul class="menu nav">
<li class="first leaf menu-links menu-level-1"><a href="https://www.doi.gov/" class="external-link">U.S. Department of the Interior</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.doioig.gov/" class="external-link">DOI Inspector General</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.whitehouse.gov/" class="external-link">White House</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.whitehouse.gov/omb/management/egov/" class="external-link">E-gov</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.doi.gov/pmb/eeo/no-fear-act" class="external-link">No Fear Act</a></li>
				<li class="last leaf menu-links menu-level-1"><a href="https://www.usgs.gov/about/organization/science-support/foia" class="external-link">FOIA</a></li>
			</ul>
</div>			
		<!-- /.footer-utl-links -->
		<!-- .footer-social-links -->
		<div class="footer-social-links">
			<ul class="social">
<li class="follow">Follow</li>
				<li class="twitter">
					<a href="https://twitter.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-twitter-square"><span class="only">Twitter</span></i>
					</a>
				</li>
				<li class="facebook">
					<a href="https://facebook.com/usgeologicalsurvey" target="_blank" class="external-link">
						<i class="fa fa-facebook-square"><span class="only">Facebook</span></i>
					</a>
				</li>
				<li class="github">
					<a href="https://github.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-github"><span class="only">GitHub</span></i>
					</a>
				</li>
				<li class="flickr">
					<a href="https://flickr.com/usgeologicalsurvey" target="_blank" class="external-link">
						<i class="fa fa-flickr"><span class="only">Flickr</span></i>
					</a>
				</li>
				<li class="youtube">
					<a href="http://youtube.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-youtube-play"><span class="only">YouTube</span></i>
					</a>
				</li>
				<li class="instagram">
					<a href="https://instagram.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-instagram"><span class="only">Instagram</span></i>
					</a>
				</li>
			</ul>
</div>
		<!-- /.footer-social-links -->
	</div>
		<!-- /.footer-wrap -->	
</footer><!-- END USGS Footer Template- --><!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKQR8KP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  
  </body>
<!-- closing div for body -->
</html>
