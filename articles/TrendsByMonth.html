<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trends by month â€¢ EGRET</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Trends by month">
<meta property="og:description" content="EGRET">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53797708-7"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53797708-7');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EGRET</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0.4.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Overview.html">Overview</a>
</li>
<li>
  <a href="../articles/EGRET.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Function Help Pages</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Enhancements.html">Enhancements</a>
    </li>
    <li>
      <a href="../articles/WRTDSK.html">WRTDS Kalman</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Running in Parallel</a>
    </li>
    <li>
      <a href="../articles/rResid.html">Random Residuals</a>
    </li>
    <li>
      <a href="../articles/SeasonalFraction.html">Seasonal Analysis</a>
    </li>
    <li>
      <a href="../articles/streamflow_trend.html">Daily Streamflow Trends</a>
    </li>
    <li>
      <a href="../articles/TrendsByMonth.html">Trends by month</a>
    </li>
    <li>
      <a href="../articles/AlternativeQMethod.html">Alternative Q Method</a>
    </li>
    <li>
      <a href="../articles/Annual_Hydrograph_Timing.html">Annual_Hydrograph_Timing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/References_WRTDS.html">Bibliograpy</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USGS-R/EGRET">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="TrendsByMonth_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Trends by month</h1>
                        <h4 class="author">Robert M. Hirsch</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/EGRET/blob/master/vignettes/TrendsByMonth.Rmd"><code>vignettes/TrendsByMonth.Rmd</code></a></small>
      <div class="hidden name"><code>TrendsByMonth.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette is about producing a single type of figure. It is designed to examine the trends between a pair of years (using <strong>runPairs</strong> in EGRET terminology) to see what the size of the trend is for each of the twelve months of the year. It was used to make Figure 8 in Choquette et al., 2019. It is very helpful in trying to see if the trend is very specific to a certain part of the year (or even opposite in different parts of the year) versus being fairly similar across all the months.</p>
</div>
<div id="how-to-do-it" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-do-it" class="anchor"></a>How to do it</h2>
<p>You need two functions. One is called <strong>runPairsMonths.R</strong> to do the computations and the other is called <strong>plotOne.R</strong> which makes the plots. These two functions are included below. You should set up a working directory and then you can copy these functions into your working directory. You be you need an EGRET eList in the directory as well. It should be an eList for which modelEstimation has already been run.</p>
<p>Here is the code</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This is function called runPairsMonths</span>
<span class="co"># It is virtually identical to the EGRET function runPairs</span>
<span class="co"># To learn the meaning of each of these initial arguments</span>
<span class="co"># The best thing to do is load the EGRET package</span>
<span class="co"># and then do ?runPairs</span>
<span class="co"># the help page you will get defines all of these</span>
<span class="va">runPairsMonths</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eList</span>, <span class="va">year1</span>, <span class="va">year2</span>, <span class="va">windowSide</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">flowBreak</span> <span class="op">=</span> <span class="cn">FALSE</span>,
         <span class="va">Q1EndDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">QStartDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">QEndDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">wall</span> <span class="op">=</span> <span class="cn">FALSE</span>,
         <span class="va">oldSurface</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">sample1EndDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">sampleStartDate</span> <span class="op">=</span> <span class="cn">NA</span>,
         <span class="va">sampleEndDate</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">minNumObs</span> <span class="op">=</span> <span class="fl">100</span>,
         <span class="va">minNumUncen</span> <span class="op">=</span> <span class="fl">50</span>, <span class="va">fractMin</span> <span class="op">=</span> <span class="fl">0.75</span>, <span class="va">windowY</span> <span class="op">=</span> <span class="fl">7</span>, <span class="va">windowQ</span> <span class="op">=</span> <span class="fl">2</span>,
         <span class="va">windowS</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">edgeAdjust</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
<span class="va">paStart</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">paLong</span> <span class="op">&lt;-</span> <span class="fl">12</span> 

<span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">wall</span> <span class="op">&amp;</span> <span class="va">oldSurface</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Setting both arguments wall and oldSurfaces to TRUE are not allowed."</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Re-calculating surface."</span><span class="op">)</span>
    <span class="va">oldSurface</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="../reference/is.egret.html">is.egret</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Please check eList argument"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">localSample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSample.html">getSample</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span>
  <span class="va">startEndSurface1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/startEnd.html">startEnd</a></span><span class="op">(</span><span class="va">paStart</span>, <span class="va">paLong</span>, <span class="va">year1</span><span class="op">)</span>
  <span class="va">startEndSurface2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/startEnd.html">startEnd</a></span><span class="op">(</span><span class="va">paStart</span>, <span class="va">paLong</span>, <span class="va">year2</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">startEndSurface2</span><span class="op">$</span><span class="va">startDate</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">localSample</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"year2 is outside the Sample range"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">startEndSurface1</span><span class="op">$</span><span class="va">endDate</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">localSample</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"year1 is outside the Sample range"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">sampleStartDate</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sampleStartDate</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">localSample</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleStartDate</span><span class="op">)</span>
  <span class="va">numSamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">localSample</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>
  <span class="va">sampleEndDate</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sampleEndDate</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">localSample</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="va">numSamples</span><span class="op">]</span>
  <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleEndDate</span><span class="op">)</span>
  <span class="va">localDaily</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDaily.html">getDaily</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span>
  <span class="va">QStartDate</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">QStartDate</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">QStartDate</span><span class="op">)</span>
  <span class="va">numQDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>
  <span class="va">QEndDate</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">QEndDate</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="va">numQDays</span><span class="op">]</span>
  <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">QEndDate</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">sampleStartDate</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Sample start is later than year2"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">sampleEndDate</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">startEndSurface2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Sample end is earlier than year1"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">localsurfaces</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSurfaces.html">getSurfaces</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">oldSurface</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">localsurfaces</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"No surface included in eList, running estSurface function"</span><span class="op">)</span>
      <span class="va">oldSurface</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">flowBreak</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Q1EndDate</span><span class="op">)</span><span class="op">)</span> 
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"if there is a flowBreak you must provide Q1EndDate"</span><span class="op">)</span>
  <span class="va">flowNormStartCol</span> <span class="op">&lt;-</span> <span class="st">"flowNormStart"</span>
  <span class="va">flowNormEndCol</span> <span class="op">&lt;-</span> <span class="st">"flowNormEnd"</span>
  <span class="va">flowStartCol</span> <span class="op">&lt;-</span> <span class="st">"flowStart"</span>
  <span class="va">flowEndCol</span> <span class="op">&lt;-</span> <span class="st">"flowEnd"</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">windowSide</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">flowBreak</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">flowStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">flowEnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">flowNormStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">QStartDate</span>, <span class="va">QStartDate</span><span class="op">)</span>
    <span class="va">flowNormEnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">QEndDate</span>, <span class="va">QEndDate</span><span class="op">)</span>
    <span class="va">dateInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">flowNormStart</span>, <span class="va">flowNormEnd</span>, <span class="va">flowStart</span>, 
                           <span class="va">flowEnd</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">windowSide</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">flowBreak</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">dateInfo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeDateInfo.html">makeDateInfo</a></span><span class="op">(</span><span class="va">windowSide</span>, <span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, 
                              <span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">QStartDate</span>, <span class="va">QEndDate</span><span class="op">)</span>
    <span class="va">dateInfo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeDateInfo.html">makeDateInfo</a></span><span class="op">(</span><span class="va">windowSide</span>, <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, 
                              <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">QStartDate</span>, <span class="va">QEndDate</span><span class="op">)</span>
    <span class="va">dateInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">dateInfo1</span>, <span class="va">dateInfo2</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">windowSide</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">flowBreak</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">Q1EndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">Q1EndDate</span><span class="op">)</span>
    <span class="va">Q2StartDate</span> <span class="op">&lt;-</span> <span class="va">Q1EndDate</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">flowStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">flowEnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">flowNormStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">QStartDate</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">Q2StartDate</span><span class="op">)</span><span class="op">)</span>
    <span class="va">flowNormEnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">Q1EndDate</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">QEndDate</span><span class="op">)</span><span class="op">)</span>
    <span class="va">dateInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">flowNormStart</span>, <span class="va">flowNormEnd</span>, <span class="va">flowStart</span>, 
                           <span class="va">flowEnd</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="op">{</span>
    <span class="va">Q1EndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">Q1EndDate</span><span class="op">)</span>
    <span class="va">Q2StartDate</span> <span class="op">&lt;-</span> <span class="va">Q1EndDate</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">dateInfo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeDateInfo.html">makeDateInfo</a></span><span class="op">(</span><span class="va">windowSide</span>, <span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, 
                              <span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">QStartDate</span>, <span class="va">Q1EndDate</span><span class="op">)</span>
    <span class="va">dateInfo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeDateInfo.html">makeDateInfo</a></span><span class="op">(</span><span class="va">windowSide</span>, <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, 
                              <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, <span class="va">Q2StartDate</span>, <span class="va">QEndDate</span><span class="op">)</span>
    <span class="va">dateInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">dateInfo1</span>, <span class="va">dateInfo2</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">wall</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sample1EndDate</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"When using the wall option, please specify sample1EndDate"</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">sample1EndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sample1EndDate</span><span class="op">)</span>
    <span class="va">sample2StartDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sample1EndDate</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">sample1StartDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleStartDate</span><span class="op">)</span>
    <span class="va">sample2EndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleEndDate</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="op">{</span>
    <span class="va">sample1StartDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleStartDate</span><span class="op">)</span>
    <span class="va">sample2StartDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleStartDate</span><span class="op">)</span>
    <span class="va">sample1EndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleEndDate</span><span class="op">)</span>
    <span class="va">sample2EndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">sampleEndDate</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">Sample1</span> <span class="op">&lt;-</span> <span class="va">localSample</span><span class="op">[</span><span class="va">localSample</span><span class="op">$</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">sample1StartDate</span> <span class="op">&amp;</span> 
                           <span class="va">localSample</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">sample1EndDate</span>, <span class="op">]</span>
  <span class="va">Sample2</span> <span class="op">&lt;-</span> <span class="va">localSample</span><span class="op">[</span><span class="va">localSample</span><span class="op">$</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">sample2StartDate</span> <span class="op">&amp;</span> 
                           <span class="va">localSample</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">sample2EndDate</span>, <span class="op">]</span>
  <span class="va">fractMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">fractMin</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="va">minNumObs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">minNumObs</span>, <span class="va">fractMin</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, 
                           <span class="va">fractMin</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">minNumUncen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">*</span> <span class="va">minNumObs</span>, <span class="va">minNumUncen</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Sample1 has "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="st">" Samples and "</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Uncen</span><span class="op">)</span>, <span class="st">" are uncensored"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Sample2 has "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="st">" Samples and "</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Uncen</span><span class="op">)</span>, <span class="st">" are uncensored"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"minNumObs has been set to "</span>, <span class="va">minNumObs</span>, <span class="st">" minNumUncen has been set to "</span>, 
          <span class="va">minNumUncen</span><span class="op">)</span>
  <span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">minNumObs</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">check</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">minNumObs</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">check</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">minNumUncen</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Uncen</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">check</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">minNumUncen</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Uncen</span><span class="op">)</span><span class="op">)</span> 
    <span class="va">check</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Data set too small for minNumObs or minNumUncen"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Sample1 has "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="st">" Samples and "</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Sample1</span><span class="op">$</span><span class="va">Uncen</span><span class="op">)</span>, <span class="st">" are uncensored"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Sample2 has "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="st">" Samples and "</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Sample2</span><span class="op">$</span><span class="va">Uncen</span><span class="op">)</span>, <span class="st">" are uncensored"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"minNumObs has been set to "</span>, <span class="va">minNumObs</span>, <span class="st">" minNumUncen has been set to "</span>, 
          <span class="va">minNumUncen</span><span class="op">)</span>
  <span class="va">Daily1</span> <span class="op">&lt;-</span> <span class="va">localDaily</span><span class="op">[</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">dateInfo</span><span class="op">$</span><span class="va">flowNormStart</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> 
                         <span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">dateInfo</span><span class="op">$</span><span class="va">flowNormEnd</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="op">]</span>
  <span class="va">Daily2</span> <span class="op">&lt;-</span> <span class="va">localDaily</span><span class="op">[</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">dateInfo</span><span class="op">$</span><span class="va">flowNormStart</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> 
                         <span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;=</span> <span class="va">dateInfo</span><span class="op">$</span><span class="va">flowNormEnd</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="op">]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">oldSurface</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/checkSurfaceSpan.html">checkSurfaceSpan</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"LogQ"</span>, <span class="st">"surfaceIndex"</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">localsurfaces</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">surfaceYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">localsurfaces</span>, <span class="st">"Year"</span><span class="op">)</span>
      <span class="va">LogQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">localsurfaces</span>, <span class="st">"LogQ"</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">else</span> <span class="op">{</span>
      <span class="va">localINFO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getInfo.html">getInfo</a></span><span class="op">(</span><span class="va">eList</span><span class="op">)</span>
      <span class="va">LogQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">localINFO</span><span class="op">$</span><span class="va">bottomLogQ</span>, by <span class="op">=</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">stepLogQ</span>, 
                  length.out <span class="op">=</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">nVectorLogQ</span><span class="op">)</span>
      <span class="va">surfaceYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">localINFO</span><span class="op">$</span><span class="va">bottomYear</span>, by <span class="op">=</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">stepYear</span>, 
                         length.out <span class="op">=</span> <span class="va">localINFO</span><span class="op">$</span><span class="va">nVectorYear</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">startDec1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decimalDate.html">decimalDate</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">endDec1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decimalDate.html">decimalDate</a></span><span class="op">(</span><span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">startDec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decimalDate.html">decimalDate</a></span><span class="op">(</span><span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">endDec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decimalDate.html">decimalDate</a></span><span class="op">(</span><span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">surfIndex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">surfaceYear</span> <span class="op">&gt;=</span> <span class="va">startDec1</span> <span class="op">&amp;</span> <span class="va">surfaceYear</span> <span class="op">&lt;=</span> 
                          <span class="va">endDec1</span><span class="op">)</span>
    <span class="va">surfIndex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">surfIndex1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">surfIndex1</span>, <span class="va">surfIndex1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">surfIndex1</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> 
                      <span class="fl">1</span><span class="op">)</span>
    <span class="va">surfIndex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">surfaceYear</span> <span class="op">&gt;=</span> <span class="va">startDec2</span> <span class="op">&amp;</span> <span class="va">surfaceYear</span> <span class="op">&lt;=</span> 
                          <span class="va">endDec2</span><span class="op">)</span>
    <span class="va">surfIndex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">surfIndex2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">surfIndex2</span>, <span class="va">surfIndex2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">surfIndex2</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> 
                      <span class="fl">1</span><span class="op">)</span>
    <span class="va">surfaces1</span> <span class="op">&lt;-</span> <span class="va">localsurfaces</span><span class="op">[</span>, <span class="va">surfIndex1</span>, <span class="op">]</span>
    <span class="va">surfaces2</span> <span class="op">&lt;-</span> <span class="va">localsurfaces</span><span class="op">[</span>, <span class="va">surfIndex2</span>, <span class="op">]</span>
    <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">surfaces1</span>, <span class="st">"LogQ"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LogQ</span>
    <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">surfaces1</span>, <span class="st">"Year"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">surfaceYear</span><span class="op">[</span><span class="va">surfIndex1</span><span class="op">]</span>
    <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">surfaces2</span>, <span class="st">"LogQ"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LogQ</span>
    <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">surfaces2</span>, <span class="st">"Year"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">surfaceYear</span><span class="op">[</span><span class="va">surfIndex2</span><span class="op">]</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="op">{</span>
    <span class="va">surfaces1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estSurfaces.html">estSurfaces</a></span><span class="op">(</span><span class="va">eList</span>, surfaceStart <span class="op">=</span> <span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, 
                             surfaceEnd <span class="op">=</span> <span class="va">startEndSurface1</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, localSample <span class="op">=</span> <span class="va">Sample1</span>, 
                             minNumObs <span class="op">=</span> <span class="va">minNumObs</span>, minNumUncen <span class="op">=</span> <span class="va">minNumUncen</span>, 
                             windowY <span class="op">=</span> <span class="va">windowY</span>, windowQ <span class="op">=</span> <span class="va">windowQ</span>, windowS <span class="op">=</span> <span class="va">windowS</span>, 
                             edgeAdjust <span class="op">=</span> <span class="va">edgeAdjust</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="va">surfaces2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estSurfaces.html">estSurfaces</a></span><span class="op">(</span><span class="va">eList</span>, surfaceStart <span class="op">=</span> <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"startDate"</span><span class="op">]</span><span class="op">]</span>, 
                             surfaceEnd <span class="op">=</span> <span class="va">startEndSurface2</span><span class="op">[[</span><span class="st">"endDate"</span><span class="op">]</span><span class="op">]</span>, localSample <span class="op">=</span> <span class="va">Sample2</span>, 
                             minNumObs <span class="op">=</span> <span class="va">minNumObs</span>, minNumUncen <span class="op">=</span> <span class="va">minNumUncen</span>, 
                             windowY <span class="op">=</span> <span class="va">windowY</span>, windowQ <span class="op">=</span> <span class="va">windowQ</span>, windowS <span class="op">=</span> <span class="va">windowS</span>, 
                             edgeAdjust <span class="op">=</span> <span class="va">edgeAdjust</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">DailyRS1FD1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estDailyFromSurfaces.html">estDailyFromSurfaces</a></span><span class="op">(</span><span class="va">eList</span>, localsurfaces <span class="op">=</span> <span class="va">surfaces1</span>, 
                                      localDaily <span class="op">=</span> <span class="va">Daily1</span><span class="op">)</span>
  <span class="va">annualFlex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setupYears.html">setupYears</a></span><span class="op">(</span><span class="va">DailyRS1FD1</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, paStart <span class="op">=</span> <span class="va">paStart</span><span class="op">)</span>
  <span class="va">c11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNConc</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">f11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNFlux</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">DailyRS2FD2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estDailyFromSurfaces.html">estDailyFromSurfaces</a></span><span class="op">(</span><span class="va">eList</span>, localsurfaces <span class="op">=</span> <span class="va">surfaces2</span>, 
                                      localDaily <span class="op">=</span> <span class="va">Daily2</span><span class="op">)</span>
  <span class="va">annualFlex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setupYears.html">setupYears</a></span><span class="op">(</span><span class="va">DailyRS2FD2</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, paStart <span class="op">=</span> <span class="va">paStart</span><span class="op">)</span>
  <span class="va">c22</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNConc</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">f22</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNFlux</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">Daily0</span> <span class="op">&lt;-</span> <span class="va">localDaily</span><span class="op">[</span><span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span> <span class="op">&gt;=</span> <span class="va">QStartDate</span> <span class="op">&amp;</span> <span class="va">localDaily</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;=</span> 
                         <span class="va">QEndDate</span>, <span class="op">]</span>
  <span class="va">DailyRS1FD0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estDailyFromSurfaces.html">estDailyFromSurfaces</a></span><span class="op">(</span><span class="va">eList</span>, localsurfaces <span class="op">=</span> <span class="va">surfaces1</span>, 
                                      localDaily <span class="op">=</span> <span class="va">Daily0</span><span class="op">)</span>
  <span class="va">annualFlex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setupYears.html">setupYears</a></span><span class="op">(</span><span class="va">DailyRS1FD0</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, paStart <span class="op">=</span> <span class="va">paStart</span><span class="op">)</span>
  <span class="va">c10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNConc</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">f10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNFlux</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">DailyRS2FD0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estDailyFromSurfaces.html">estDailyFromSurfaces</a></span><span class="op">(</span><span class="va">eList</span>, localsurfaces <span class="op">=</span> <span class="va">surfaces2</span>, 
                                      localDaily <span class="op">=</span> <span class="va">Daily0</span><span class="op">)</span>
  <span class="va">annualFlex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setupYears.html">setupYears</a></span><span class="op">(</span><span class="va">DailyRS2FD0</span>, paLong <span class="op">=</span> <span class="va">paLong</span>, paStart <span class="op">=</span> <span class="va">paStart</span><span class="op">)</span>
  <span class="va">c20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNConc</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">f20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">annualFlex</span><span class="op">$</span><span class="va">FNFlux</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">cDeltaTotal</span> <span class="op">&lt;-</span> <span class="va">c22</span> <span class="op">-</span> <span class="va">c11</span>
  <span class="va">cRSpart</span> <span class="op">&lt;-</span> <span class="va">c20</span> <span class="op">-</span> <span class="va">c10</span>
  <span class="va">cFDpart</span> <span class="op">&lt;-</span> <span class="va">cDeltaTotal</span> <span class="op">-</span> <span class="va">cRSpart</span>
  <span class="va">fDeltaTotal</span> <span class="op">&lt;-</span> <span class="va">f22</span> <span class="op">-</span> <span class="va">f11</span>
  <span class="va">fRSpart</span> <span class="op">&lt;-</span> <span class="va">f20</span> <span class="op">-</span> <span class="va">f10</span>
  <span class="va">fFDpart</span> <span class="op">&lt;-</span> <span class="va">fDeltaTotal</span> <span class="op">-</span> <span class="va">fRSpart</span>
  <span class="va">totChangePct_conc</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">cDeltaTotal</span><span class="op">/</span><span class="va">c11</span>
  <span class="va">totChangePct_flux</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">fDeltaTotal</span><span class="op">/</span><span class="va">f11</span>
  <span class="va">CQTC_percent_conc</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">cRSpart</span><span class="op">/</span><span class="va">c11</span>
  <span class="va">QTC_percent_conc</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">cFDpart</span><span class="op">/</span><span class="va">c11</span>
  <span class="va">CQTC_percent_flux</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">fRSpart</span><span class="op">/</span><span class="va">f11</span>
  <span class="va">QTC_percent_flux</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">fFDpart</span><span class="op">/</span><span class="va">f11</span>
  <span class="va">pairResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">7</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairResults</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TotalChange"</span>, <span class="st">"CQTC"</span>, <span class="st">"QTC"</span>, 
                             <span class="st">"x10"</span>, <span class="st">"x11"</span>, <span class="st">"x20"</span>, <span class="st">"x22"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">pairResults</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Conc"</span>, <span class="st">"Flux"</span><span class="op">)</span>
  <span class="va">pairResults</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cDeltaTotal</span>, <span class="va">cRSpart</span>, <span class="va">cFDpart</span>, <span class="va">c10</span>, 
                        <span class="va">c11</span>, <span class="va">c20</span>, <span class="va">c22</span><span class="op">)</span>
  <span class="va">pairResults</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.00036525</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fDeltaTotal</span>, <span class="va">fRSpart</span>, 
                                     <span class="va">fFDpart</span>, <span class="va">f10</span>, <span class="va">f11</span>, <span class="va">f20</span>, <span class="va">f22</span><span class="op">)</span>
  <span class="va">yearPairInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">paStart</span>, <span class="va">paLong</span>, <span class="va">year1</span>, <span class="va">year2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">yearPairInfo</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"paStart"</span>, <span class="st">"paLong"</span>, <span class="st">"year1"</span>, <span class="st">"year2"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">pairResults</span>, <span class="st">"yearPair"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">yearPairInfo</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">pairResults</span>, <span class="st">"dateInfo"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dateInfo</span>
  <span class="va">SampleBlocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample1StartDate</span>, <span class="va">sample1EndDate</span>, <span class="va">sample2StartDate</span>, 
                    <span class="va">sample2EndDate</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">SampleBlocks</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sample1StartDate"</span>, <span class="st">"sample1EndDate"</span>, 
                           <span class="st">"sample2StartDate"</span>, <span class="st">"sample2EndDate"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">pairResults</span>, <span class="st">"SampleBlocks"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">SampleBlocks</span>
  <span class="va">Other</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>minNumObs <span class="op">=</span> <span class="va">minNumObs</span>, minNumUncen <span class="op">=</span> <span class="va">minNumUncen</span>, 
                windowY <span class="op">=</span> <span class="va">windowY</span>, windowQ <span class="op">=</span> <span class="va">windowQ</span>, windowS <span class="op">=</span> <span class="va">windowS</span>, 
                wall <span class="op">=</span> <span class="va">wall</span>, edgeAdjust <span class="op">=</span> <span class="va">edgeAdjust</span>, QStartDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">QStartDate</span><span class="op">)</span>, 
                QEndDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">QEndDate</span><span class="op">)</span>, PercentChangeConc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Total Percent Change` <span class="op">=</span> <span class="va">totChangePct_conc</span>, 
                                                                    `CQTC Percent` <span class="op">=</span> <span class="va">CQTC_percent_conc</span>, `QTC Percent` <span class="op">=</span> <span class="va">QTC_percent_conc</span><span class="op">)</span>, 
                PercentChangeFlux <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Total Percent Change` <span class="op">=</span> <span class="va">totChangePct_flux</span>, 
                                      `CQTC Percent` <span class="op">=</span> <span class="va">CQTC_percent_flux</span>, `QTC Percent` <span class="op">=</span> <span class="va">QTC_percent_flux</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">pairResults</span>, <span class="st">"Other"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Other</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n  "</span>, <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">shortName</span>, <span class="st">"\n  "</span>, <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">paramShortName</span><span class="op">)</span>
  <span class="va">periodName</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setSeasonLabelByUser.html">setSeasonLabelByUser</a></span><span class="op">(</span><span class="va">paStart</span>, <span class="va">paLong</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n  "</span>, <span class="va">periodName</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">wall</span><span class="op">)</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n Sample data set was partitioned with a wall right after "</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">sample1EndDate</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n Change estimates "</span>, <span class="va">year2</span>, <span class="st">" minus "</span>, <span class="va">year1</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="va">totChange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">pairResults</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="va">totChangePct_conc_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">totChangePct_conc</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n For concentration: total change is "</span>, <span class="va">totChange</span>, 
      <span class="st">"mg/L"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n expressed as Percent Change is "</span>, <span class="va">totChangePct_conc_f</span>, 
      <span class="st">"%"</span><span class="op">)</span>
  <span class="va">pctRS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">CQTC_percent_conc</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">pctFD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">QTC_percent_conc</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n\n Concentration v. Q Trend Component "</span>, <span class="va">pctRS</span>, <span class="st">"%\n       Q Trend Component            "</span>, 
      <span class="va">pctFD</span>, <span class="st">"% \n\n"</span><span class="op">)</span>
  <span class="va">totChange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">pairResults</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="va">totChangePct_flux_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="op">(</span><span class="va">totChangePct_flux</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n For flux: total change is "</span>, <span class="va">totChange</span>, <span class="st">"million kg/year"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n expressed as Percent Change is "</span>, <span class="va">totChangePct_flux_f</span>, 
      <span class="st">"%"</span><span class="op">)</span>
  <span class="va">pctRS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">CQTC_percent_flux</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">pctFD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">QTC_percent_flux</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n\n Concentration v. Q Trend Component "</span>, <span class="va">pctRS</span>, <span class="st">"%\n       Q Trend Component            "</span>, 
      <span class="va">pctFD</span>, <span class="st">"% \n\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pairResults</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Jan"</span>,<span class="st">"Feb"</span>,<span class="st">"Mar"</span>,<span class="st">"Apr"</span>,<span class="st">"May"</span>,<span class="st">"Jun"</span>,<span class="st">"Jul"</span>,<span class="st">"Aug"</span>,<span class="st">"Sep"</span>,<span class="st">"Oct"</span>,<span class="st">"Nov"</span>,<span class="st">"Dec"</span><span class="op">)</span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">28.25</span>, <span class="fl">31</span>, <span class="fl">30</span>, <span class="fl">31</span>, <span class="fl">30</span>, <span class="fl">31</span>, <span class="fl">31</span>, <span class="fl">30</span>, <span class="fl">31</span>, <span class="fl">30</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">/</span> <span class="va">eList</span><span class="op">$</span><span class="va">INFO</span><span class="op">$</span><span class="va">drainSqKm</span>
  <span class="va">eList1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.egret.html">as.egret</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">INFO</span>, <span class="va">DailyRS1FD1</span>, <span class="va">eList</span><span class="op">$</span><span class="va">Sample</span><span class="op">)</span>
  <span class="va">monthlyResults1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateMonthlyResults.html">calculateMonthlyResults</a></span><span class="op">(</span><span class="va">eList1</span><span class="op">)</span>
  <span class="va">monthlyResults1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">monthlyResults1</span><span class="op">)</span>
  <span class="va">eList2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.egret.html">as.egret</a></span><span class="op">(</span><span class="va">eList</span><span class="op">$</span><span class="va">INFO</span>, <span class="va">DailyRS2FD2</span>, <span class="va">eList</span><span class="op">$</span><span class="va">Sample</span><span class="op">)</span>
  <span class="va">monthlyResults2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateMonthlyResults.html">calculateMonthlyResults</a></span><span class="op">(</span><span class="va">eList2</span><span class="op">)</span>
  <span class="va">monthlyResults2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">monthlyResults2</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">{</span>
    <span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">monthlyResults1</span><span class="op">[</span><span class="va">monthlyResults1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="va">i</span>,<span class="op">]</span>
    <span class="va">z</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m1</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">*</span> <span class="va">k</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">m2</span> <span class="op">&lt;-</span> <span class="va">monthlyResults2</span><span class="op">[</span><span class="va">monthlyResults2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="va">i</span>,<span class="op">]</span>
    <span class="va">z</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">*</span> <span class="va">k</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#</span>
<span class="co">#</span>
<span class="co"># this is written for kg/month/km^2</span>
<span class="co"># the arguments yMax, arrowFactor, and name can all be</span>
<span class="co"># adjusted to make some changes in the figure</span>
<span class="va">plotOne</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span>, <span class="va">yMax</span> <span class="op">=</span> <span class="cn">NA</span>, <span class="va">arrowFactor</span> <span class="op">=</span> <span class="fl">0.4</span>, 
                    <span class="va">name</span> <span class="op">=</span> <span class="st">"Change in yield, by month"</span><span class="op">)</span><span class="op">{</span>
<span class="va">zMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>
<span class="va">yMax</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">yMax</span><span class="op">)</span><span class="op">)</span> <span class="va">zMax</span> <span class="op">*</span> <span class="fl">1.05</span> <span class="kw">else</span> <span class="va">yMax</span>
<span class="va">monthAbb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"J"</span>,<span class="st">"F"</span>,<span class="st">"M"</span>,<span class="st">"A"</span>,<span class="st">"M"</span>,<span class="st">"J"</span>,<span class="st">"J"</span>,<span class="st">"A"</span>,<span class="st">"S"</span>,<span class="st">"O"</span>,<span class="st">"N"</span>,<span class="st">"D"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>las <span class="op">=</span> <span class="fl">1</span>, tck <span class="op">=</span> <span class="fl">0.02</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span>,<span class="va">z</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">12.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">yMax</span><span class="op">)</span>,
      xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"Change in yield, kg / month / km^2"</span>,
     main <span class="op">=</span> <span class="va">name</span>, col <span class="op">=</span> <span class="st">"black"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, cex.lab <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">monthAbb</span>, tick <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="cn">NULL</span>, labels <span class="op">=</span> <span class="cn">TRUE</span>, tick <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">3</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>, labels <span class="op">=</span> <span class="cn">FALSE</span>, tick <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">4</span>, at <span class="op">=</span> <span class="cn">NULL</span>, labels <span class="op">=</span> <span class="cn">FALSE</span>, tick <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span>,<span class="va">z</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">12.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">yMax</span><span class="op">)</span>,
     xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,
     main <span class="op">=</span> <span class="st">""</span>, col <span class="op">=</span> <span class="st">"red"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> <span class="fl">12</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x0</span> <span class="op">&lt;-</span> <span class="va">m</span>
  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">m</span>
  <span class="va">y0</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="fl">1</span>,<span class="va">m</span><span class="op">]</span>
  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="fl">2</span>,<span class="va">m</span><span class="op">]</span>
  <span class="va">col</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">y1</span> <span class="op">&gt;</span> <span class="va">y0</span><span class="op">)</span> <span class="st">"red"</span> <span class="kw">else</span> <span class="st">"black"</span>
  <span class="va">length</span> <span class="op">&lt;-</span> <span class="va">arrowFactor</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">y1</span> <span class="op">-</span> <span class="va">y0</span><span class="op">)</span> 
  <span class="va">angle</span> <span class="op">&lt;-</span> <span class="fl">30</span>
  <span class="va">lwd</span> <span class="op">&lt;-</span> <span class="fl">2</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">y0</span>, <span class="va">x1</span>, <span class="va">y1</span>, length <span class="op">=</span> <span class="va">length</span>, angle <span class="op">=</span> <span class="va">angle</span>, col <span class="op">=</span> <span class="va">col</span>, lwd <span class="op">=</span> <span class="va">lwd</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Now letâ€™s run it</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pubs.usgs.gov/tm/04/a10/">EGRET</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Conowingo.PO4.RData"</span><span class="op">)</span>
<span class="co"># source("runPairsMonths.R")</span>
<span class="co"># source("plotOne.R")</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">runPairsMonths</span><span class="op">(</span><span class="va">eList</span>, year1 <span class="op">=</span> <span class="fl">2006</span>, year2 <span class="op">=</span> <span class="fl">2017</span><span class="op">)</span></code></pre></div>
<pre><code>## Sample1 has 925 Samples and 769 are uncensored</code></pre>
<pre><code>## Sample2 has 925 Samples and 769 are uncensored</code></pre>
<pre><code>## minNumObs has been set to 100 minNumUncen has been set to 50</code></pre>
<pre><code>## Sample1 has 925 Samples and 769 are uncensored</code></pre>
<pre><code>## Sample2 has 925 Samples and 769 are uncensored</code></pre>
<pre><code>## minNumObs has been set to 100 minNumUncen has been set to 50</code></pre>
<pre><code>## 
##    SUSQUEHANNA RIVER AT CONOWINGO, MD 
##    00671
##    Calendar Year 
## 
##  Change estimates  2017  minus  2006 
## 
##  For concentration: total change is  0.000904 mg/L
##  expressed as Percent Change is  10 %
## 
##  Concentration v. Q Trend Component  10 %
##        Q Trend Component             0 % 
## 
## 
##  For flux: total change is  0.116 million kg/year
##  expressed as Percent Change is  31 %
## 
##  Concentration v. Q Trend Component  31 %
##        Q Trend Component             0 % 
## 
##      TotalChange   CQTC QTC    x10    x11    x20    x22
## Conc      0.0009 0.0009   0 0.0088 0.0088 0.0097 0.0097
## Flux      0.1164 0.1164   0 0.3698 0.3698 0.4862 0.4862</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># z contains the results, they are expressed as yields in kg/month/km^2</span>
<span class="co"># z[1,1:12] are the yields in year 1, by month Jan, Feb, ... Dec</span>
<span class="co"># z[2,1:12] are the yields in year 2, by month Jan, Feb, ... Dec</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></code></pre></div>
<pre><code>##            Jan       Feb       Mar       Apr       May       Jun       Jul
## [1,] 0.6273932 0.4739879 0.7075350 0.6380653 0.3619343 0.2097517 0.1878099
## [2,] 0.8347853 0.4960114 0.8392184 0.7795324 0.3860591 0.2166557 0.2252040
##            Aug       Sep       Oct       Nov       Dec
## [1,] 0.1927015 0.3222020 0.3493139 0.4913913 0.7070998
## [2,] 0.2696814 0.5610262 0.5496506 0.7390136 1.0301296</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#</span>
<span class="fu">plotOne</span><span class="op">(</span><span class="va">z</span><span class="op">)</span></code></pre></div>
<p><img src="TrendsByMonth_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">####</span>
<span class="co">###we might want to make a few changes in the look of the figure, for example</span>

<span class="fu">plotOne</span><span class="op">(</span><span class="va">z</span>, yMax <span class="op">=</span> <span class="fl">1.2</span>, arrowFactor <span class="op">=</span> <span class="fl">0.6</span>, name <span class="op">=</span> <span class="st">"Change in yield between 2006 and 2017\nPO4 at Conowingo"</span><span class="op">)</span></code></pre></div>
<p><img src="TrendsByMonth_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
</div>
<div id="reference-cited" class="section level1">
<h1 class="hasAnchor">
<a href="#reference-cited" class="anchor"></a>Reference cited</h1>
<p>Choquette, A.F., Hirsch, R.M., Murphy, J.C., Johnson, L.T. and Confesor Jr, R.B., 2019. Tracking changes in nutrient delivery to western Lake Erie: Approaches to compensate for variability and trends in streamflow. Journal of Great Lakes Research, 45(1), pp.21-39.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robert Hirsch, Laura DeCicco.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
